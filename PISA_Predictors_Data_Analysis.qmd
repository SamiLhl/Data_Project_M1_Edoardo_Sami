---
title: "PISA Predictors: Data Analysis"
author: "Edoardo Ruvolo, Sami Louahlia"
format: html
execute:
  message: false
  warning: false
echo: false
---


```{r}
here::i_am("Data_Project_M1_Edoardo_Sami.Rproj")
library(here)
library(ggplot2)
library(dplyr)
library(vroom)
library(tidyr)
library(nlstools)
```
## Research Project : Exploratory analysis of potential predictors of PISA Scores

[Link to the Github Repository](https://github.com/SamiLhl/Data_Project_M1_Edoardo_Sami) 
This is the same Repository as for the Data Treatment, we now proceed with the Dataset we produced in a new quarto document.

## Part 1 : Research Question 





## Part 2 : Data sets descriptions (size, production condition, main variables)*



## Part 3 : Data analysis

```{r}
Dataset <- read.csv(here("Final_Data"))
```

### Fertility Rates and PISA Scores

The underlying assumption behind suspecting this relation stems from a 'quality over quantity' reasoning. When the population rapidly expands in size, the quantity of workers, able to finance children's education, relative to the quantity of children, in need of education provision, diminishes. As such, we expect countries with high fertility rates to have lower PISA scores. 

```{r Fert_Math}
ggplot(Dataset, aes(x= Fertility.Rate, y=Math_Score))+
geom_point()+
xlab("Fertility Rate") +
ylab("Math_Score") +
ggtitle("Scatterplot of PISA Math score given Fertility Rate") +
theme_minimal()+
theme(axis.text.x = element_text(angle = 45, hjust = 1))

```


```{r Fert_Sci}
ggplot(Dataset, aes(x= Fertility.Rate, y=Science_Score))+
geom_point()+
xlab("Fertility Rate") +
ylab("Science_Score") +
ggtitle("Scatterplot of PISA Science score given Fertility Rate") +
theme_minimal()+
theme(axis.text.x = element_text(angle = 45, hjust = 1))
```


```{r Fert_Read}
ggplot(Dataset, aes(x= Fertility.Rate, y=Reading_Score))+
geom_point()+
xlab("Fertility Rate") +
ylab("Reading_Score") +
ggtitle("Scatterplot of PISA Reading score given Fertility Rate") +
theme_minimal()+
theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

There seem to be some form of negative linear relationship between fertility rate and PISA scores. The Reading Score seem to correlate less strongly with fertility rates. 

```{r}
cor_fer_mat <- cor.test(Dataset$Math_Score,Dataset$Fertility.Rate)
mod_fer_mat <- lm(Math_Score ~ Fertility.Rate, data = Dataset)

cor_fer_sci <- cor.test(Dataset$Science_Score,Dataset$Fertility.Rate)
mod_fer_sci <- lm(Science_Score ~ Fertility.Rate, data = Dataset)

cor_fer_read <- cor.test(Dataset$Reading_Score,Dataset$Fertility.Rate)
mod_fer_read <- lm(Reading_Score ~ Fertility.Rate, data = Dataset)

##table_fert <- summarise(co 

```

All the correlations are significant (p<.01). The best linear models provide sizeable coefficients. For an increase in fertility rate of 1, the expected national PISA score decreases by 62.4 in math, 55.1 in science and 52.2 in reading.
It may be important to account for the fact that low fertility rates at a national level are generally associated with higher living standards and higher income. As such, it might be necessary to control for some metrics, such as gdp per capita to ensure that fertility rates truly play a role in providing better education.


### Population Density 


```{r Dens_Math}
ggplot(Dataset, aes(x= Poulation.density, y=Math_Score))+
geom_point()+
xlab("Population Density") +
ylab("Math_Score") +
ggtitle("Scatterplot of PISA Math score given Population Density") +
theme_minimal()+
theme(axis.text.x = element_text(angle = 45, hjust = 1))

```

```{r Dens_Sci}
ggplot(Dataset, aes(x= Poulation.density, y=Science_Score))+
geom_point()+
xlab("Population Density") +
ylab("Science_Score") +
ggtitle("Scatterplot of PISA Science score given Population Density") +
theme_minimal()+
theme(axis.text.x = element_text(angle = 45, hjust = 1))

```

```{r Dens_Read}
ggplot(Dataset, aes(x= Poulation.density, y=Reading_Score))+
geom_point()+
xlab("Fertility Rate") +
ylab("Reading_Score") +
ggtitle("Scatterplot of PISA Reading score given Population Density") +
theme_minimal()+
theme(axis.text.x = element_text(angle = 45, hjust = 1))

```
There does not seem to be any form of linear correlation between population density and PISA scores. 

### Entrance Age
There are important debate on the impact of the entrance age of pupils into school and their academic performances. 
```{r}
Entrance_PISA <- Dataset |> select(Math_Score, Reading_Score, Science_Score, Entrance_Mandatory)|> filter(!is.na(Entrance_Mandatory))
```


```{r Entr_Math}

ggplot(Entrance_PISA, aes(x= as.factor(Entrance_Mandatory), y=Math_Score))+
geom_boxplot()+
xlab("Mandatory Entrance Age") +
ylab("Math Score") +
ggtitle("Scatterplot of PISA Math score given national Entrance Age into school") +
theme_minimal()+
theme(axis.text.x = element_text(angle = 45, hjust = 1))

```
```{r Entr_Sci}
ggplot(Entrance_PISA, aes(x= as.factor(Entrance_Mandatory), y=Science_Score))+
geom_boxplot()+
xlab("Mandatory Entrance Age") +
ylab("Science Score") +
ggtitle("Scatterplot of PISA Science score given national Entrance Age into school") +
theme_minimal()+
theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

```{r Entr_Read}
ggplot(Entrance_PISA, aes(x= as.factor(Entrance_Mandatory), y=Reading_Score))+
geom_boxplot()+
xlab("Mandatory Entrance Age") +
ylab("Reading Score") +
ggtitle("Scatterplot of PISA Reading score given national Entrance Age into school") +
theme_minimal()+
theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

There seem to be a non-linear relationship between Mandatory Entrance Age and PISA scores. Which reflects quite well the tradeoffs often mentioned in the literature, according to which, children may need time to mature before entering school, even though waiting for too long might not be profitable as children would be ready to for being schooled and are not, meaning they might reach the age/year for taking the PISA with less competencies acquired during school than other pupils who started school earlier.()
We thus try modeling a non linear relationship between Mandatory Entrance Age and PISA scores

```{r}
##mod_age_mat <- nls(Math_Score ~ log(Entrance_Mandatory), data =Entrance_PISA, start = ##(Entrance_Mandatory = 3))
```





