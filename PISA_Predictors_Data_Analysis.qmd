---
title: "PISA Predictors: Data Analysis"
author: "Edoardo Ruvolo, Sami Louahlia"
format: 
   wordcount-html:
    toc: true
    fig-align: center
    cap-location: margin
execute:
  message: false
  warning: false
echo: false
---


```{r}
here::i_am("Data_Project_M1_Edoardo_Sami.Rproj")
library(here)
library(ggplot2)
library(dplyr)
library(vroom)
library(tidyr)
library(nlstools)
library(broom)
```
## Research Project : Exploratory analysis of potential predictors of PISA Scores

[Link to the Github Repository](https://github.com/SamiLhl/Data_Project_M1_Edoardo_Sami) 
This is the same Repository as for the Data Treatment, we now proceed with the Dataset we produced in a new quarto document.

## Part 1 : Research Question 

## Part 2 : Data sets descriptions (size, production condition, main variables)*

## Part 3 : Data analysis


```{r}
Dataset <- read.csv(here("Final_Data"))
```
## Financial Condition and PISA score

Rich countries may generally be expected to provide better education services as they have greater means for doing so and need a highly educated population to perform tasks with important added value.Economies with an ambition for reaching high income status may also strive towards educating its population to become as productive as in advanced economies. Thus, observing these indicators in their ability to predict PISA scores is of great relevance. Moreover, these characteristics, if powerful in predicting PISA score, might be used as control variable to observe other socio-economic phenomena. Therefore, we start our analysis with these variables. 

### GNI per Capita and Fertility Rate

```{r}
ggplot(Dataset, aes(x= GNI.per.capita, y=Math_Score))+
geom_point()+
  geom_smooth(method = "lm", se = FALSE, color = "blue")+
xlab("GNI per capita") +
ylab("Math_Score") +
ggtitle("Scatterplot of PISA Math score given GNI per capita") +
theme_minimal()+
theme(axis.text.x = element_text(angle = 45, hjust = 1))
```
It appears that GNI per capita is powerfully correlated with PISA scores. However, it seems that it ceases to be, past a certain level of income. At first sight, this could perhaps be represented by a form of a log function, given we overlook the very high income outliers, which generally represent small population such as Qatar, Singapore or Luxembourg.

```{r GNI and PISA}
mod_GDP_sci <- lm(Science_Score ~ GNI.per.capita, data=Dataset)
```
GNI per capita is indeed, significantly associated with higher PISA Scores


### GDP growth and PISA Scores 
Booming economies may have hopes to become an advanced economy in the span of a generation or two, in a similar fashion the Asian tigers did in past. As such countries experiencing high economic growth may put greater efforts in their education services and have greater PISA scores.

```{r}
ggplot(Dataset, aes(x= GDP.rate, y=Math_Score))+
geom_point()+
xlab("GDP growth rate") +
ylab("Math_Score") +
ggtitle("Scatterplot of PISA Math score given GDP growth rate") +
theme_minimal()+
theme(axis.text.x = element_text(angle = 45, hjust = 1))
```
As can be seen, graphical representation of Math Score being only predicted by growth rate does not show much. By doing so, we confound high income countries, which have lower growth rate as they do not experience growth from convergence with lower income countries that also have lower growth rate. It is necessary to control for GNI per capita before assessing the relevance of the growth rate of the economy in predicting PISA scores.

```{r gy controlling for GNI per cap}
mod_gy_sci_GDPc <- lm(Science_Score ~ GDP.rate + GNI.per.capita , data=Dataset)
summary(mod_gy_sci_GDPc)
```
Once controlling for GDP per capita, it appears that the growth rate of the economy is not significantly correlated with PISA scores.


### Fertility Rates and PISA Scores


The literature, generally supports a negative relationship between fertility rates and educational achievements. One possible explanation takes the form of a 'quality over quantity' reasoning. When the population rapidly expands in size, the quantity of workers, able to finance children's education, relative to the quantity of children, in need of education provision, diminishes (Hu, 2023; Sittisom, 2020). This is also notably channelled through women enjoying greater education than their parents having less children. For instance, Osili and Long (2007) found that increase female education by one year reduces early fertility by 0.26 in Nigeria. This implies that it might also be education that reduces fertility rate (Brand and Davis, 2012). 
As such, we expect countries with high fertility rates to have lower PISA scores. 





```{r Fert_Sci}
ggplot(Dataset, aes(x= Fertility.Rate, y=Science_Score))+
geom_point()+
  geom_smooth(method = "lm", se = FALSE, color = "blue")+
xlab("Fertility Rate") +
ylab("Science_Score") +
ggtitle("Scatterplot of PISA Science score given Fertility Rate") +
theme_minimal()+
theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

There seem to be some form of negative linear relationship between fertility rate and PISA scores. The Reading Score seem to correlate less strongly with fertility rates. 

```{r first attempt with Fertility}
cor_fer_sci <- cor.test(Dataset$Science_Score,Dataset$Fertility.Rate)
mod_fer_sci <- lm(Science_Score ~ Fertility.Rate, data = Dataset)
```

The correlation is significant (p<.01). The best linear model provide sizeable coefficient. For an increase in fertility rate of 1, the expected national PISA score decreases 55.1 in science.

It may be important to account for the fact that low fertility rates at a national level are generally associated with higher living standards and higher income. As such, it might be necessary to control for some metrics, such as gdp per capita to ensure that fertility rates truly play a role in providing better education.

```{r Controlling for GDP per capita}
mod_fer_sci_GDPc <- lm(Science_Score ~ Fertility.Rate + GNI.per.capita, data=Dataset)
summary(mod_fer_sci_GDPc)

```
After controlling for GNI per capita, fertility are still, significantly, negatively associated with PISA scores. An increase of 1 in fertility rate is associated with a 43.85 points decrease in Science score.

### Population Density 

Population density could potentially affect academic performance through multiple channels. For instance, low population density could lead to longer commuting time to school. However, high density areas may have multiple schools and reinforce social segregation between schools in turn potentially decreasing the means available to children of lower strata people. Borland and Howsen (1999) investigate this dynamic in Kentucky and notice that students from highly urban and highly rural areas perform similarly, and worse than students enjoying more moderate population density.

```{r Dens_Sci}
ggplot(Dataset, aes(x= Poulation.density, y=Science_Score))+
geom_point()+
xlab("Population Density") +
ylab("Science_Score") +
ggtitle("Scatterplot of PISA Science score given Population Density") +
theme_minimal()+
theme(axis.text.x = element_text(angle = 45, hjust = 1))

```

There does not seem to be any form of linear correlation between population density and PISA scores. However, the relationship we are looking for should rather look like a u-shaped curve and we do not control for GNI per capita.

```{r Non linear model of Pop_Density controlling for GNI per capita}

```


### Entrance Age
There are important debate on the impact of the entrance age of pupils into school and their academic performances. The Child Care Research Network (2007) argued that even though, kids entering school at an older age did perform better than their younger counterparts, these advantages were small in magnitude and decreased in importance over time. 
```{r}
Entrance_PISA <- Dataset |> select( Science_Score, Entrance_Mandatory)|> filter(!is.na(Entrance_Mandatory))
```



```{r Entr_Sci}
ggplot(Entrance_PISA, aes(x= as.factor(Entrance_Mandatory), y=Science_Score))+
geom_boxplot()+
xlab("Mandatory Entrance Age") +
ylab("Science Score") +
ggtitle("Scatterplot of PISA Science score given national Entrance Age into school") +
theme_minimal()+
theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

There seem to be a non-linear relationship between Mandatory Entrance Age and PISA scores. Which reflects quite well the tradeoffs often mentioned in the literature, according to which, children may need time to mature before entering school, even though waiting for too long might not be profitable as children would be ready to for being schooled and are not, meaning they might reach the age/year for taking the PISA with less competencies acquired during school than other pupils who started school earlier.()
We thus try modeling a non linear relationship between Mandatory Entrance Age and PISA scores

```{r}
##mod_age_mat <- nls(Math_Score ~ log(Entrance_Mandatory), data =Entrance_PISA, start = ##(Entrance_Mandatory = 3))
```


## Mean Yrs of Schooling MIGHT HAVE TO NONO OUT OF EXISTENCE FOR NOT BEING RELEVANT AT ALL (THE LADS ARE ALL TAKING THE TEST IN LATE MIDDLE SCHOOL SO THAT SHOWS NOTHING BEYONG MEAN YRS BEING HIGHER FOR RICH COUNTRIES)
```{r Mean_Schl_Math}
ggplot(Dataset, aes(x= Mean_Yrs_Schooling, y=Science_Score))+
geom_point()+
  geom_smooth(method = "lm", se = FALSE, color = "blue")+
xlab("Mean Years of Schooling") +
ylab("Math Score") +
ggtitle("Scatterplot of PISA Reading score given Mean Years of schooling ") +
theme_minimal()+
theme(axis.text.x = element_text(angle = 45, hjust = 1))
```


## Start and End Month

This variable may be used in multiple fashions. One point of interest might be the length of the school year. 
(ADD ARTICLES SAYING STUFF ABOUT THAT)
```{r}
YrLength_PISA <- Dataset |> select( Science_Score, End_Month, Start_Month)
```

```{r}
YrLength_PISA$Year_Length <- (YrLength_PISA$End_Month - YrLength_PISA$Start_Month + 12) %% 12
YrLength_PISA$Year_Length <- ifelse(YrLength_PISA$Year_Length < 4, NA, YrLength_PISA$Year_Length)
```
Some values seem hardly probable and are very rare, thus we omit them for further analysis (EXPAND ON THAT)

```{r Yr_Length_Sci}
YrLength_PISA <- YrLength_PISA |> filter(!is.na(Year_Length))
ggplot(YrLength_PISA, aes(x= as.factor(Year_Length), y=Science_Score))+
geom_boxplot()+
xlab("Year_Length") +
ylab("Math Score") +
ggtitle("Scatterplot of PISA Math score given the Year Length") +
theme_minimal()+
theme(axis.text.x = element_text(angle = 45, hjust = 1))
```
There does not seem to be a linear relationship between academic year length and PISA scores.

### Survival rate 
```{r Mean_Surv_Math}
ggplot(Dataset, aes(x=Survival_Rate_Primary, y=Science_Score))+
geom_point() +
  geom_smooth(method = "lm", se = FALSE, color = "blue") +
xlab("Survival rate") +
ylab("Science Score") +
ggtitle("Scatterplot of PISA Science score given the mortality rate ") +
theme_minimal()+
theme(axis.text.x = element_text(angle = 45, hjust = 1))
```
### Governament Expenditure

```{r}
ggplot(Dataset, aes(x=Gov_Expenditure, y=Science_Score))+
geom_point()+
  geom_smooth(method = "lm", se = FALSE, color = "blue") +
xlab("Governamenent Expenditure") +
ylab("Science Score") +
ggtitle("Scatterplot of PISA Science score given gvernament expenditure") +
theme_minimal()+
theme(axis.text.x = element_text(angle = 45, hjust = 1))
```
Science score is independent from the governament expenditure. The average governament expenditure is around 1 and is related to a math score of 490.
By increasing the expenditure there is no benefit to the math score.

### Enrolment rate
```{r}
ggplot(Dataset, aes(x=Enrolment_Rate, y=Science_Score))+
geom_point()+
  geom_smooth(method = "lm", se = FALSE, color = "blue") +
xlab("Enrolemnt Rate") +
ylab("Science Score") +
ggtitle("Scatterplot of PISA Science Score given Enrolment Rate") +
theme_minimal()+
theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

### SHare of private expenditure
```{r}
ggplot(Dataset, aes(x=Share_Private, y=Science_Score))+
geom_point()+
  geom_smooth(method = "lm", se = FALSE, color = "blue") +
xlab("Share Private") +
ylab("Science Score") +
ggtitle("Scatterplot of PISA Science Score given Share Private") +
theme_minimal()+
theme(axis.text.x = element_text(angle = 45, hjust = 1))
```
### General overview to explain why we can use only science
```{r}
Dataset %>% group_by(Year) %>% summarise(Math_Score = mean(Math_Score), Science_Score=mean(Science_Score), Reading_Score = mean(Reading_Score)) %>%
ggplot (aes(x = Year)) +
  geom_line(aes(y = Math_Score, color = "Math Score")) +
  geom_line(aes(y = Science_Score, color = "Science Score")) +
  geom_line(aes(y = Reading_Score, color = "Reading Score")) +
  xlab("Year") +
  ylab("Score") +
  ggtitle("Scores Growth Over Years") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  scale_color_manual(values = c("Math Score" = "blue", "Science Score" = "red", "Reading Score" = "green"))
```
We can see that the scores over the years present a similar pattern. There is a clear drop after 2012, that caused scores to drop by 20 points circa. Since we found that three scores have a similar behaviours, we might decide to conduct our analysis only using one of them, in this case science.


### Trial on the regression 
```{r}
ggplot(Dataset, aes(x= GNI.per.capita, y=Science_Score))+
geom_point()+
xlab("GNI per capita") +
ylab("Science Score") +
ggtitle("Scatterplot of PISA science score given GNI per capita") +
theme_minimal()+
theme(axis.text.x = element_text(angle = 45, hjust = 1))
```
```{r}
lm1 <- lm(Science_Score ~ Survival_Rate_Primary, data=Dataset)
summary(lm1)
```

```{r, message=FALSE}
lm2 <- lm(Science_Score ~ Survival_Rate_Primary + GNI.per.capita, data=Dataset)
summary(lm2)
```

```{r, message=FALSE}
lm3 <- lm(Science_Score ~ Survival_Rate_Primary + Enrolment_Rate + GNI.per.capita, data=Dataset)
summary(lm3)
```
Add a comment for each of them

## Annex + Sources


### Sources 

Child Care Research Network, N. E. (2007). Age of Entry to Kindergarten and Children’s Academic Achievement and Socioemotional Development. Early Education and Development, 18(2), 337. https://doi.org/10.1080/10409280701283460

Borland, M. V., & Howsen, R. M. (1999). A Note on Student Academic Performance: In Rural versus Urban Areas. The American Journal of Economics and Sociology, 58(3), 537–546. http://www.jstor.org/stable/3487782

Hu, H. The Consequences of Fertility Decline on Educational Attainment in China. Popul Res Policy Rev 42, 94 (2023). https://doi-org.proxy.bu.dauphine.fr/10.1007/s11113-023-09834-7

Sittisom,W. (2020). Barriers in way towards quality education: poverty, fertility rate and
increasing population, Journal of Security and Sustainability Issues, 9(January), 215-227. http://doi.org/10.9770/jssi.2020.9.J(16)

Brand, J. E., & Davis, D. (2011). The Impact of College Education on Fertility: Evidence for Heterogeneous Effects. Demography, 48(3), 863. https://doi.org/10.1007/s13524-011-0034-3

Osili, U. and Long, B. T. (2007). Does female schooling reduce fertility? evidence from nigeria.. https://doi.org/10.3386/w13070